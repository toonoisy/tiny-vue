{"version":3,"file":"index.js","sources":["../src/dep.js","../src/watcher.js","../src/compiler.js","../src/observer.js","../src/index.js"],"sourcesContent":["class Dep {\n  target = null;\n  constructor () {\n    this.subs = new Set();\n  }\n\n  addSub (sub) {\n    this.subs.add(sub);\n  }\n\n  notify () {\n    this.subs.forEach(sub => {\n      sub.update();\n    })\n  }\n}\n\nexport default Dep;","import Dep from './dep';\n\nclass Watcher {\n  constructor (key, vm, callback) {\n    this.$vm = vm;\n    this.key = key;\n    this.callback = callback;\n    this.value = this.get();\n    this.update();\n  }\n\n  get() {\n    Dep.target = this;\n    // trigger getter to call Dep.addSub(dep.target)\n    const value = this.getValue();\n    Dep.target = null;\n    return value;\n  }\n\n  getValue () {\n    const chain = this.key.split('.');\n    // this.xx.xx ...\n    const value = chain.reduce((acc, cur) => {\n      return acc[`${cur}`];\n    }, this.$vm);\n    return value;\n  }\n\n  update () {\n    const newValue = this.get();\n    this.callback(newValue);\n  }\n}\n\nexport default Watcher;","import Watcher from './watcher';\n\nclass Compiler {\n  constructor (el, vm) {\n    this.$vm = vm;\n    this.$el = this.isElementNode(el) ? el : document.querySelector(el);\n    this.compile(this.$el);\n  }\n\n  isElementNode (node) {\n    return node.nodeType === 1;\n  }\n\n  isTextNode (node) {\n    return node.nodeType === 3;\n  }\n\n  isDirective (attrName) {\n    return attrName.startsWith('v-');\n  }\n\n  compile (el) {\n    [...el.childNodes].forEach(node => {\n      if (this.isElementNode(node)) {\n        this.compileElement(node);\n      } else if (this.isTextNode){\n        this.compileText(node);\n      }\n\n      // compile children nodes\n      if (node.childNodes.length) {\n        this.compile(node);\n      }\n    });\n  }\n\n  compileElement (node) {\n    [...node.attributes].forEach(attr => {\n      const attrName = attr.name;\n      if (this.isDirective(attrName)) {\n        const [ name, arg ] = attrName.substring(2).split(':');\n        const key = attr.value;\n        this.processDirective(node, key, name, arg);\n      }\n    })\n  }\n\n  compileText (node) {\n    const textContent = node.textContent;\n    if ((/({{.+?}})/g).test(textContent)) {\n      const key = textContent.replace(/^{{|}}$/g, '').trim();\n      key && new Watcher(key, this.$vm, (val) => {\n        node.textContent = val;\n      })\n    }\n  }\n\n  processDirective (node, key, name, arg) {\n    switch (name) {\n      case 'on':\n        node.addEventListener(arg, this.$vm[key].bind(this.$vm));\n        break;\n      case 'model':\n        new Watcher(key, this.$vm, (val) => {\n          node.value = val;\n        });\n        node.addEventListener('input', () => {\n          this.$vm[key] = node.value;\n        });\n        break;\n      default:\n        break;\n    }\n  }\n}\n\nexport default Compiler;","import Dep from './dep';\n\nclass Observer {\n  constructor (data) {\n    this.observe(data);\n  }\n\n  // hijack data properties, turn them into reactive\n  observe (data) {\n    if (!data || typeof data !== 'object') return;\n    for (const key in data) {\n      if (Object.hasOwnProperty.call(data, key)) {\n        this.defineReactive(data, key, data[key]);\n      }\n    }\n  }\n\n  defineReactive (data, key, value) {\n    const dep = new Dep();\n    this.observe(value);\n    Object.defineProperty(data, key, {\n      enumerable: true,\n      configurable: true,\n      get () {\n        Dep.target && dep.addSub(Dep.target);\n        return value;\n      },\n      set (newValue) {\n        if (value === newValue) return;\n        value = newValue;\n        dep.notify();\n      }\n    });\n  }\n}\n\nexport default Observer;","import Compiler from './compiler';\nimport Observer from './observer';\n\nclass Instance {\n  constructor (options = {}) {\n    this.$options = options;\n    new Observer(options.data);\n    this._initProxy(options);\n    new Compiler(options.el, this);\n  }\n\n  _initProxy ({ data, computed, methods }) {\n    this.dataProxy(data);\n    this.computedProxy(computed);\n    this.methodsProxy(methods);\n  }\n\n  dataProxy (data) {\n    Object.keys(data).forEach(key => {\n      Object.defineProperty(this, key, {\n        enumerable: true,\n        configurable: true,\n        get() {\n          return data[key];\n        },\n        set(newValue) {\n          data[key] = newValue;\n        }\n      })\n    });\n  }\n\n  computedProxy (computed) {\n    Object.keys(computed).forEach(key => {\n      Object.defineProperty(this, key, {\n        enumerable: true,\n        configurable: true,\n        get() {\n          return computed[key].call(this);\n        },\n        set() {}\n      })\n    });\n  }\n\n  methodsProxy (methods) {\n    Object.keys(methods).forEach(key => {\n      Object.defineProperty(this, key, {\n        enumerable: true,\n        configurable: true,\n        get() {\n          return methods[key];\n        },\n        set() {}\n      })\n    });\n  }\n}\n\n// window.Instance = Instance;\n\n// module.exports = Instance;\nexport default Instance;"],"names":["Dep","target","constructor","this","subs","Set","addSub","sub","add","notify","forEach","update","Watcher","key","vm","callback","$vm","value","get","getValue","split","reduce","acc","cur","newValue","Compiler","el","$el","isElementNode","document","querySelector","compile","node","nodeType","isTextNode","isDirective","attrName","startsWith","childNodes","compileElement","compileText","length","attributes","attr","name","arg","substring","processDirective","textContent","test","replace","trim","val","addEventListener","bind","Observer","data","observe","Object","hasOwnProperty","call","defineReactive","dep","defineProperty","enumerable","configurable","set","options","$options","_initProxy","computed","methods","dataProxy","computedProxy","methodsProxy","keys"],"mappings":"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"}